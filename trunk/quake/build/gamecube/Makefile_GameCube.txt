# About the release.
DATE					:= `get_date.sh`
VERSION					:= $(DATE)_BETA

# About the platform.
PLATFORM_UPPER			:= GAMECUBE
PLATFORM_LOWER			:= gamecube

# Extra files.
GAMECUBE_DOL		:= ../../dist/gamecube/Quake.dol
PLATFORM_OBJS		:= \
	../../obj/$(PLATFORM_LOWER)/gamecube/tffs/diskio.o \
	../../obj/$(PLATFORM_LOWER)/gamecube/tffs/tff.o\
	../../obj/$(PLATFORM_LOWER)/gamecube/fileio/sdfileio.o
PLATFORM_TARGETS	:= $(GAMECUBE_DOL)

# Compiler flags.
# Note that we MUST USE -fno-merge-constants, because the compiler generates crap otherwise.
GAMECUBE_FLAGS		:= -DGEKKO -mcpu=750 -meabi -mhard-float -g -Wall -pipe -O3 -fno-merge-constants
CFLAGS				:= $(GAMECUBE_FLAGS)
CXXFLAGS			:= $(GAMECUBE_FLAGS) -fno-exceptions -fno-rtti
LDFLAGS				:= $(GAMECUBE_FLAGS) -mogc

# Linker info.
LIBS				:= -logc -lm -logcsys -lsdcard

# Programs.
PREFIX				:= powerpc-gekko-
CC					:= $(PREFIX)gcc
CXX					:= $(PREFIX)g++
LD					:= $(PREFIX)g++
OBJCOPY				:= $(PREFIX)objcopy

# Standard include.
include Makefile_Generic.txt

# How to make the .DOL file.
$(GAMECUBE_DOL): $(ELF)
	@echo Creating $(notdir $@)
	@$(OBJCOPY) -O binary $< $@

# How to install.
install: $(GAMECUBE_DOL)
	@echo Installing
	@cp $(GAMECUBE_DOL) S:/
	@cp $(DIST_DIR)/ID1/CONFIG.CFG S:/ID1/

# How to build the distribution.
ZIP_FILE		:= Quake_2007_08_03_BETA.zip
ZIP_CONTENTS	:= Quake.dol ID1/CONFIG.CFG GPL.txt readme.html

dist: clean all
	@echo Building distribution
	rm -f $(DIST_DIR)/$(ZIP_FILE)
	cd $(DIST_DIR) && zip -9 -r $(ZIP_FILE) $(ZIP_CONTENTS)
