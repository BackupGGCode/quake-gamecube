SRC_DIR		:= ../../src
OBJ_DIR		:= ../../obj/$(PLATFORM_LOWER)
DIST_DIR	:= ../../dist/$(PLATFORM_LOWER)

GENERIC_OBJS := \
	$(OBJ_DIR)/$(PLATFORM_LOWER)/input.o \
	$(OBJ_DIR)/$(PLATFORM_LOWER)/main.o \
	$(OBJ_DIR)/$(PLATFORM_LOWER)/sound.o \
	$(OBJ_DIR)/$(PLATFORM_LOWER)/system.o \
	$(OBJ_DIR)/$(PLATFORM_LOWER)/video_software.o \
	\
	$(OBJ_DIR)/generic/cd_null.o \
	$(OBJ_DIR)/generic/chase.o \
	$(OBJ_DIR)/generic/cl_demo.o \
	$(OBJ_DIR)/generic/cl_input.o \
	$(OBJ_DIR)/generic/cl_main.o \
	$(OBJ_DIR)/generic/cl_parse.o \
	$(OBJ_DIR)/generic/cl_tent.o \
	$(OBJ_DIR)/generic/cmd.o \
	$(OBJ_DIR)/generic/common.o \
	$(OBJ_DIR)/generic/console.o \
	$(OBJ_DIR)/generic/crc.o \
	$(OBJ_DIR)/generic/cvar.o \
	$(OBJ_DIR)/generic/d_edge.o \
	$(OBJ_DIR)/generic/d_fill.o \
	$(OBJ_DIR)/generic/d_init.o \
	$(OBJ_DIR)/generic/d_modech.o \
	$(OBJ_DIR)/generic/d_part.o \
	$(OBJ_DIR)/generic/d_polyse.o \
	$(OBJ_DIR)/generic/d_scan.o \
	$(OBJ_DIR)/generic/d_sky.o \
	$(OBJ_DIR)/generic/d_sprite.o \
	$(OBJ_DIR)/generic/d_surf.o \
	$(OBJ_DIR)/generic/d_vars.o \
	$(OBJ_DIR)/generic/d_zpoint.o \
	$(OBJ_DIR)/generic/draw.o \
	$(OBJ_DIR)/generic/file.o \
	$(OBJ_DIR)/generic/host.o \
	$(OBJ_DIR)/generic/host_cmd.o \
	$(OBJ_DIR)/generic/keys.o \
	$(OBJ_DIR)/generic/mathlib.o \
	$(OBJ_DIR)/generic/menu.o \
	$(OBJ_DIR)/generic/model.o \
	$(OBJ_DIR)/generic/net_loop.o \
	$(OBJ_DIR)/generic/net_main.o \
	$(OBJ_DIR)/generic/net_none.o \
	$(OBJ_DIR)/generic/net_vcr.o \
	$(OBJ_DIR)/generic/nonintel.o \
	$(OBJ_DIR)/generic/pr_cmds.o \
	$(OBJ_DIR)/generic/pr_edict.o \
	$(OBJ_DIR)/generic/pr_exec.o \
	$(OBJ_DIR)/generic/r_aclip.o \
	$(OBJ_DIR)/generic/r_alias.o \
	$(OBJ_DIR)/generic/r_bsp.o \
	$(OBJ_DIR)/generic/r_draw.o \
	$(OBJ_DIR)/generic/r_edge.o \
	$(OBJ_DIR)/generic/r_efrag.o \
	$(OBJ_DIR)/generic/r_light.o \
	$(OBJ_DIR)/generic/r_main.o \
	$(OBJ_DIR)/generic/r_misc.o \
	$(OBJ_DIR)/generic/r_part.o \
	$(OBJ_DIR)/generic/r_sky.o \
	$(OBJ_DIR)/generic/r_sprite.o \
	$(OBJ_DIR)/generic/r_surf.o \
	$(OBJ_DIR)/generic/r_vars.o \
	$(OBJ_DIR)/generic/sbar.o \
	$(OBJ_DIR)/generic/screen.o \
	$(OBJ_DIR)/generic/snd_dma.o \
	$(OBJ_DIR)/generic/snd_mem.o \
	$(OBJ_DIR)/generic/snd_mix.o \
	$(OBJ_DIR)/generic/sv_main.o \
	$(OBJ_DIR)/generic/sv_move.o \
	$(OBJ_DIR)/generic/sv_phys.o \
	$(OBJ_DIR)/generic/sv_user.o \
	$(OBJ_DIR)/generic/view.o \
	$(OBJ_DIR)/generic/wad.o \
	$(OBJ_DIR)/generic/world.o \
	$(OBJ_DIR)/generic/zone.o

OBJS := $(PLATFORM_OBJS) $(GENERIC_OBJS)

# Where's the elf?
ELF := $(OBJ_DIR)/Quake.elf

# How to build everything.
all: $(PLATFORM_TARGETS)

# How to clean.
clean:
	@echo Cleaning
	@rm -f $(OBJS) $(PLATFORM_TARGETS) $(ELF)

# How to compile a C++ source file.
$(OBJ_DIR)/%.o: $(SRC_DIR)/%.cpp
	@echo Compiling $(notdir $<)
	@mkdir -p $(dir $@)
	@$(CXX) $(CXXFLAGS) -c $< -o $@

# How to compile a C source file.
$(OBJ_DIR)/%.o: $(SRC_DIR)/%.c
	@echo Compiling $(notdir $<)
	@mkdir -p $(dir $@)
	@$(CC) $(CFLAGS) -c $< -o $@

# How to link the ELF.
$(ELF): $(OBJS)
	@echo Linking $(notdir $@)
	@mkdir -p $(dir $@)
	@$(LD) $(LDFLAGS) $(OBJS) $(LIBS) -o $@
